<div class="zones-page">
  <!-- List View -->
  @if (viewMode === 'list') {
  <div class="page-header">
    <div class="header-content">
      <h1>Gestion des Zones</h1>
      <p>Gerez les zones de stationnement et leurs rues</p>
    </div>
    @if (canManageZones) {
    <button class="btn btn-primary" (click)="openCreateModal()">
      <svg
        xmlns="http://www.w3.org/2000/svg"
        width="20"
        height="20"
        viewBox="0 0 24 24"
        fill="none"
        stroke="currentColor"
        stroke-width="2"
      >
        <line x1="12" y1="5" x2="12" y2="19"></line>
        <line x1="5" y1="12" x2="19" y2="12"></line>
      </svg>
      Nouvelle Zone
    </button>
    }
  </div>

  @if (isLoading) {
  <div class="loading">
    <div class="spinner"></div>
    <p>Chargement des zones...</p>
  </div>
  } @else if (error) {
  <div class="error-state">
    <p>{{ error }}</p>
    <button class="btn btn-secondary" (click)="loadZones()">
      Reessayer
    </button>
  </div>
  } @else {
  <div class="zones-grid">
    @for (zone of zones; track zone._id) {
    <div class="zone-card" [class.inactive]="!zone.isActive">
      <div class="zone-header">
        <div class="zone-code-badge">{{ zone.code }}</div>
        <div class="zone-info">
          <h3>{{ zone.name }}</h3>
          <p class="zone-description">
            {{ zone.description || 'Aucune description' }}
          </p>
          @if (zone.address) {
            <p class="zone-address">
              <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
                <circle cx="12" cy="10" r="3"></circle>
              </svg>
              {{ zone.address }}
            </p>
          }
          @if (zone.phoneNumber) {
            <p class="zone-phone">
              <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"></path>
              </svg>
              {{ zone.phoneNumber }}
            </p>
          }
        </div>
        <span
          class="status-badge"
          [class.active]="zone.isActive"
          [class.inactive]="!zone.isActive"
        >
          {{ zone.isActive ? 'Active' : 'Inactive' }}
        </span>
      </div>

      <div class="zone-details">
        <div class="detail-row">
          <div class="detail-item">
            <span class="label">Tarif horaire</span>
            <span class="value">{{ zone.hourlyRate }} TND/h</span>
          </div>
          <div class="detail-item">
            <span class="label">Horaires</span>
            <span class="value">{{ zone.operatingHours }}</span>
          </div>
        </div>
        <div class="detail-row">
          <div class="detail-item">
            <span class="label">Sabot</span>
            <span class="value">{{ zone.prices?.car_sabot || 0 }} TND</span>
          </div>
          <div class="detail-item">
            <span class="label">Fourriere</span>
            <span class="value">{{ zone.prices?.pound || 0 }} TND</span>
          </div>
        </div>
        <div class="detail-row">
          <div class="detail-item">
            <span class="label">Places</span>
            <span class="value">{{ zone.numberOfPlaces || 0 }}</span>
          </div>
          <div class="detail-item">
            <span class="label">Occupation</span>
            <span class="value">--</span>
          </div>
        </div>
      </div>

      <div class="zone-actions">
        <button
          class="btn btn-sm btn-info"
          (click)="openStreetsEditor(zone)"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="16"
            height="16"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
          >
            <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
            <circle cx="12" cy="10" r="3"></circle>
          </svg>
          Rues
        </button>
        @if (canManageZones) {
        <button
          class="btn btn-sm btn-secondary"
          (click)="openEditModal(zone)"
        >
          Modifier
        </button>
        @if (zone.isActive) {
        <button class="btn btn-sm btn-warning" (click)="toggleStatus(zone)">
          Desactiver
        </button>
        } @else {
        <button class="btn btn-sm btn-success" (click)="toggleStatus(zone)">
          Activer
        </button>
        }
        <button class="btn btn-sm btn-danger" (click)="confirmDelete(zone)">
          Supprimer
        </button>
        }
      </div>
    </div>
    } @empty {
    <div class="empty-state">
      <p>Aucune zone trouvee</p>
    </div>
    }
  </div>
  } }

  <!-- Streets Editor View -->
  @if (viewMode === 'streets' && selectedZone) {
    <app-streets-editor
      [zone]="selectedZone"
      (closed)="onStreetsEditorClosed()"
      (boundaryUpdated)="onBoundaryUpdated($event)"
    ></app-streets-editor>
  }

  <!-- Create/Edit Zone Modal -->
  @if (showModal) {
    <app-zone-form-modal
      [editingZone]="editingZone"
      (saved)="onZoneSaved()"
      (closed)="closeModal()"
    ></app-zone-form-modal>
  }

  <!-- Delete Confirmation Modal -->
  @if (showDeleteModal) {
  <div class="modal-overlay" (click)="closeDeleteModal()">
    <div class="modal modal-sm" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>Confirmer la suppression</h2>
        <button class="close-btn" (click)="closeDeleteModal()">
          &times;
        </button>
      </div>
      <div class="modal-body">
        <p>
          Etes-vous sur de vouloir supprimer la zone
          <strong>{{ zoneToDelete?.name }}</strong> ?
        </p>
        <p class="warning-text">
          Cette action est irreversible et supprimera toutes les donnees
          associees.
        </p>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" (click)="closeDeleteModal()">
          Annuler
        </button>
        <button
          class="btn btn-danger"
          (click)="deleteZone()"
          [disabled]="isDeleting"
        >
          {{ isDeleting ? 'Suppression...' : 'Supprimer' }}
        </button>
      </div>
    </div>
  </div>
  }
</div>
